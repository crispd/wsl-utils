{
  "version": "2",
  "defaults": {
    "installRoot": "%USERPROFILE%/WSL",
    "scriptsDir": "scripts",
    "etcDir": "etc",
    "logDir": "%USERPROFILE%/WSL/logs",
    "backupsDir": "%USERPROFILE%/WSL/backups",
    "importTempDir": "%USERPROFILE%/WSL/temp",
    "tarNamePattern": "{distro}-{yyyy}-{MM}-{dd}_{HHmmss}.tar",
    "wslExecutable": "wsl.exe",
    "compression": "none",
    "overwriteLogs": true
  },

  "distros": [
    {
      "name": "AlmaLinux",
      "aliases": ["AlmaLinux9", "AL9"],
      "defaultUser": "dan",
      "stopBeforeBackup": true,
      "preClean": true
    }
  ],

  "scripts": {
    "ps": {
      "backup":       { "path": "scripts/powershell/Backup-WSL.ps1",     "requiresElevation": false },
      "export":       { "path": "scripts/powershell/Export-WSL.ps1",     "requiresElevation": false },
      "import":       { "path": "scripts/powershell/Import-WSL.ps1",     "requiresElevation": true  },
      "bootstrap":    { "path": "scripts/powershell/bootstrap.ps1",      "requiresElevation": false }
    },
    "bash": {
      "setDefaultUser": { "path": "scripts/bash/set-default-user.sh" },
      "preClean":       { "path": "scripts/bash/pre-export-clean.sh"   }
    }
  },

  "tasks": {
    "backup": {
      "description": "Export a WSL distro to a tar archive",
      "steps": [
        {
          "run": "ps:backup",
          "args": ["-DistroName", "{distro}", "-OutputDir", "{defaults.backupsDir}"]
        }
      ]
    },

    "export": {
      "description": "Alias of backup with explicit path",
      "steps": [
        {
          "run": "ps:export",
          "args": ["-DistroName", "{distro}", "-Output", "{output}"]
        }
      ]
    },

    "import": {
      "description": "Import a tar into a new distro",
      "steps": [
        {
          "run": "ps:import",
          "args": [
            "-NewDistroName", "{distro}",
            "-TarPath", "{tar}",
            "-InstallLocation", "{defaults.installRoot}/distros/{distro}"
          ],
          "requiresElevation": true
        }
      ]
    },

    "set-default-user": {
      "description": "Set default Linux user inside a distro",
      "steps": [
        {
          "run": "bash:setDefaultUser",
          "inDistro": "{distro}",
          "args": ["{user}"]
        }
      ]
    },

    "pre-clean": {
      "description": "Clean caches/logs/etc. inside distro prior to backup",
      "steps": [
        {
          "run": "bash:preClean",
          "inDistro": "{distro}"
        }
      ]
    }
  }
}
